# Features
- mysql
	- [x] engine
	- [x] report configs (in comments)
	- [x] table with list of all reports and their data
	- [ ] table listing all open tables and their state
	- [ ] test with 5.7
	- [x] test with mariadb (those guys install all internal headers, should be simpler to install)
	- [ ] docs (well, readme should suffice for now?)
	- [ ] guidelines - how to run mysql with jemalloc
	- [ ] debug, why mysql keeps eating memory, when started with no reports and just incoming traffic (valgrind says - everything is freed :( )
- decent logging
	- [x] i mean writing to stderr from a 'library' is not something you'd call nice
	- [ ] log levels support (with runtime change?)
- [ ] timer tag based filtering (i.e. take only timers with tag:browser=chrome)
- per-report
	- [x] rusage
	- [x] packet counts (+ drop counts, filtered out counts, bloom dropped counts)
- [x] per-report nanomsg queues instead of pubsub
	- to track packets dropps, slow reports, etc.
	- we actually leak memory if any batches get dropped (due to incrementing ref counts for all present reports)
- global stats
	- [x] mysql table
	- [x] status variables
	- [ ] make stats table the same as status variables, or remove it in favor of the former
- [ ] calculate real time window for report snapshots (i.e. skip timeslices that have had no data)
	- this is debatable, but useful for correct <something>/sec calculations


# Performance
- [ ] develop benchmark harness + learn to use perf like a pro :)
- [x] recvmmsg() in udp reader (+ settings)
	- [ ] configure support (or maybe runtime detection with dlsym?)
- [ ] {medium} sorted arrays for histograms (almost there)
- [ ] {medium} thread affinity
- [ ] {easy, minor} make request and timer tag_name_id-s into flatter arrays for faster searches (SSE mon!)
- [x] {medium} per-thread rusage (repacker seems to be the most cpu-intensive one)
- [ ] {?} increase udp kernel memory (or at least check for it) on startup
	- kernel udp memory is usually tuned very low
	- so beneficial to increase it to be able to handle high packet+data rates
	- should provide guidelines here (like 1gbps in traffic = ~120mb/sec, should probably reserve at least 60mb for 1/2 second hickups)
- [ ] {easy} flatbuffer (https://google.github.io/flatbuffers/) instead of protobuf?
	- hard to change all clients
	- not really worth it, since pb unpack doesn't seem to take that much cpu
- [ ] {hard} maybe replace nanomsg with something doing less locking / syscalls (thorough meamurements first!)
- [ ] {medium, worth it?} simple bloom filtering (aka is this report interested in this packet?)
	- a library like this one? https://github.com/mavam/libbf
	- try calculating a simple bloom filter (over tag names) for all incoming packets
	- report has it's own bloom, filled with tag names it's interested in
	- compare those 2, if no match - packet doesn't need to be inspected
	- might be memory intensive and not worth it
	- might also take a look if something like https://en.wikipedia.org/wiki/MinHash would work
- [ ] {easy, worth it?} per repacker dictionary caches (reduces locking on global dictionary)
- [ ] {medium, worth it?} per snapshot merger dictionary caches

# Internals
- [x] split pinba_globals_t into 'informational' and 'runtime engine' parts (to simplify testing/experiments)
	- informational: stats, ticker, dictionary, stuff that is just 'cogs'
	- runtime: udp readers, coorinator, the features meat
- [ ] split coordinator into 'relay thread' and 'management thread' (maybe even have management be non-threaded?)
- percentiles
	- [ ] merge histograms in report snapshots only when percentile calculation is required, do so on the fly
	- [ ] calculate all required percentiles in one go (i.e. if we need 95 and 99 - calc them in a single pass)
